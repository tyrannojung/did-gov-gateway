# DID Government Gateway

This is the gateway service for managing DIDs, VCs, and VPs on Hyperledger Fabric.

## Setup

### 1. Install Dependencies
```bash
pnpm install
```

### 2. Deploy Chaincode
```bash
# From test-network directory
./network.sh up createChannel -c mychannel -ca -s couchdb

# Deploy with simplified endorsement policy for testing
./network.sh deployCC -c mychannel -ccn anamdid \
  -ccp ../did-fabric-contract -ccl javascript -ccs 1 \
  -ccep "OR('Org1MSP.peer')"
```

### 3. Configure Environment
```bash
# Copy .env.example to .env and update Fabric paths
cp .env.example .env
# Edit .env to update FABRIC_* paths with your actual paths
```

### 4. Setup Issuer
```bash
# This will generate issuer keys and register issuer DID on chain
pnpm setup:issuer
```

### 5. Start Server
```bash
pnpm dev   # Development mode with auto-reload
# or
pnpm start # Production mode
# Server will run on port 8081
```

## API Endpoints

### DID Management
- `POST /dids/user` - Register user DID with public key
- `GET /dids/:did` - Get DID document from chain

### License Management  
- `POST /licenses` - Create license DID and issue VC
- `GET /licenses/:licenseId` - Get license DID document

### Student Card Management
- `POST /students` - Create student DID and issue VC
- `GET /students/:studentId` - Get student DID document

### VC Management
- `GET /vcs/:vcId` - Get specific VC from chain
- `GET /vcs/:vcId/verify` - Verify VC on chain

### VP Management
- `POST /vps/verify` - Verify VP with challenge

## Environment Variables

See `.env.example` for all required environment variables. The key variables include:
- `PORT` - Server port (default: 8081)
- `FABRIC_*` - Fabric connection credentials
- `ISSUER_ID` and `ISSUER_DID` - Auto-generated by pnpm setup:issuer
- `CHAINCODE_NAME` - Chaincode name (anamdid)

## API Examples

### Create Student Card
```bash
curl -X POST http://localhost:8081/students \
  -H "Content-Type: application/json" \
  -d '{
    "userDid": "did:anam145:user:2mFqX7Z5whEMAKjc9SwF3BRw",
    "studentNumber": "2023572504",
    "university": "고려대학교",
    "department": "정보보호대학원"
  }'
```

### Create Driver License
```bash
curl -X POST http://localhost:8081/licenses \
  -H "Content-Type: application/json" \
  -d '{
    "userDid": "did:anam145:user:2mFqX7Z5whEMAKjc9SwF3BRw",
    "licenseNumber": "서울-01-123456"
  }'
```

## Multiple VCs Support

A single user can have multiple VCs (Verifiable Credentials):
- Driver License VC (type: "DriverLicenseVC")
- Student Card VC (type: "StudentCardVC")
- And more can be added in the future

When creating a VP (Verifiable Presentation), users can include one or more VCs as needed.

## Security Notes

- The `src/storage/` directory contains private keys and is gitignored
- Never commit wallet files or private keys
- Always use HTTPS in production